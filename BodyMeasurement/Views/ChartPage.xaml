<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:BodyMeasurement.ViewModels"
             xmlns:chart="clr-namespace:Syncfusion.Maui.Toolkit.Charts;assembly=Syncfusion.Maui.Toolkit"
             xmlns:resources="clr-namespace:BodyMeasurement.Resources.Strings"
             x:Class="BodyMeasurement.Views.ChartPage"
             x:DataType="viewModels:ChartViewModel"
             Title="{x:Static resources:Strings.ChartTitle}">

    <Grid RowDefinitions="Auto,*">

        <!-- Time Filter Buttons -->
        <Border Grid.Row="0"
               BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#2C2C2C}"
               Padding="8"
               Margin="16,16,16,8">
            <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                <Button Text="{x:Static resources:Strings.Filter1W}"
                        Command="{Binding ChangeFilterCommand}"
                        CommandParameter="{x:Static resources:Strings.PeriodLabel1Week}"
                        BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                        TextColor="{AppThemeBinding Light=Black, Dark=White}"
                        CornerRadius="4"
                        Padding="12,6"
                        MinimumWidthRequest="60" />
                <Button Text="{x:Static resources:Strings.Filter1M}"
                        Command="{Binding ChangeFilterCommand}"
                        CommandParameter="{x:Static resources:Strings.PeriodLabel1Month}"
                        BackgroundColor="{AppThemeBinding Light=#2196F3, Dark=#1976D2}"
                        TextColor="White"
                        CornerRadius="4"
                        Padding="12,6"
                        MinimumWidthRequest="60" />
                <Button Text="{x:Static resources:Strings.Filter3M}"
                        Command="{Binding ChangeFilterCommand}"
                        CommandParameter="{x:Static resources:Strings.PeriodLabel3Months}"
                        BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                        TextColor="{AppThemeBinding Light=Black, Dark=White}"
                        CornerRadius="4"
                        Padding="12,6"
                        MinimumWidthRequest="60" />
                <Button Text="{x:Static resources:Strings.Filter6M}"
                        Command="{Binding ChangeFilterCommand}"
                        CommandParameter="{x:Static resources:Strings.PeriodLabel6Months}"
                        BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                        TextColor="{AppThemeBinding Light=Black, Dark=White}"
                        CornerRadius="4"
                        Padding="12,6"
                        MinimumWidthRequest="60" />
                <Button Text="{x:Static resources:Strings.FilterAll}"
                        Command="{Binding ChangeFilterCommand}"
                        CommandParameter="{x:Static resources:Strings.PeriodLabelAllTime}"
                        BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                        TextColor="{AppThemeBinding Light=Black, Dark=White}"
                        CornerRadius="4"
                        Padding="12,6"
                        MinimumWidthRequest="60" />
            </HorizontalStackLayout>
        </Border>

        <!-- Chart Content -->
        <Grid Grid.Row="1" Padding="16">

            <!-- Chart -->
            <chart:SfCartesianChart IsVisible="{Binding HasData}"
                                   IsEnabled="{Binding HasData}">
                
                <chart:SfCartesianChart.XAxes>
                    <chart:DateTimeAxis 
                        LabelStyle="{AppThemeBinding Light={StaticResource ChartAxisLabelStyleLight}, 
                                                     Dark={StaticResource ChartAxisLabelStyleDark}}"
                        ShowMajorGridLines="True" />
                </chart:SfCartesianChart.XAxes>

                <chart:SfCartesianChart.YAxes>
                    <chart:NumericalAxis 
                        LabelStyle="{AppThemeBinding Light={StaticResource ChartAxisLabelStyleLight}, 
                                                     Dark={StaticResource ChartAxisLabelStyleDark}}"
                        ShowMajorGridLines="True" />
                </chart:SfCartesianChart.YAxes>

                <chart:LineSeries ItemsSource="{Binding ChartData}"
                                 XBindingPath="Date"
                                 YBindingPath="WeightKg"
                                 Fill="#2196F3"
                                 ShowDataLabels="False"
                                 EnableAnimation="False"
                                 EnableTooltip="True">
                    <chart:LineSeries.MarkerSettings>
                        <chart:ChartMarkerSettings Type="Circle"
                                                  Fill="#2196F3"
                                                  Width="8"
                                                  Height="8" />
                    </chart:LineSeries.MarkerSettings>
                </chart:LineSeries>
            </chart:SfCartesianChart>

            <!-- Stats Summary (overlay at top) -->
            <Border IsVisible="{Binding HasData}"
                   VerticalOptions="Start"
                   HorizontalOptions="Center"
                   Margin="0,16,0,0"
                   BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                   Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#3C3C3C}"
                   StrokeThickness="1"
                   Padding="16,8">
                <HorizontalStackLayout Spacing="20">
                    <VerticalStackLayout Spacing="4">
                        <Label Text="{x:Static resources:Strings.StatMin}"
                               FontSize="12"
                               TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"
                               HorizontalOptions="Center" />
                        <Label FontSize="14" FontAttributes="Bold" HorizontalOptions="Center">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding MinWeight, StringFormat='{0:F1}'}" />
                                    <Span Text=" " />
                                    <Span Text="{Binding PreferredUnit}" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </VerticalStackLayout>
                    <VerticalStackLayout Spacing="4">
                        <Label Text="{x:Static resources:Strings.StatAvg}"
                               FontSize="12"
                               TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"
                               HorizontalOptions="Center" />
                        <Label FontSize="14" FontAttributes="Bold" HorizontalOptions="Center">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding AverageWeight, StringFormat='{0:F1}'}" />
                                    <Span Text=" " />
                                    <Span Text="{Binding PreferredUnit}" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </VerticalStackLayout>
                    <VerticalStackLayout Spacing="4">
                        <Label Text="{x:Static resources:Strings.StatMax}"
                               FontSize="12"
                               TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"
                               HorizontalOptions="Center" />
                        <Label FontSize="14" FontAttributes="Bold" HorizontalOptions="Center">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding MaxWeight, StringFormat='{0:F1}'}" />
                                    <Span Text=" " />
                                    <Span Text="{Binding PreferredUnit}" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </VerticalStackLayout>
                </HorizontalStackLayout>
            </Border>

            <!-- Empty State -->
            <VerticalStackLayout IsVisible="{Binding HasData, Converter={StaticResource InvertedBoolConverter}}"
                                VerticalOptions="Center"
                                HorizontalOptions="Center"
                                Padding="32">
                <Label Text="{x:Static resources:Strings.NoChartData}"
                       FontSize="18"
                       FontAttributes="Bold"
                       HorizontalTextAlignment="Center" />
                <Label Text="{x:Static resources:Strings.ChartAddMoreMeasurements}"
                       FontSize="14"
                       HorizontalTextAlignment="Center"
                       TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"
                       Margin="0,8,0,0" />
            </VerticalStackLayout>

            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsLoading}"
                              IsVisible="{Binding IsLoading}"
                              HorizontalOptions="Center"
                              VerticalOptions="Center" />

        </Grid>
    </Grid>

</ContentPage>
